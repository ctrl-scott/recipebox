<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Animated Recipe Box</title>
  <style>
    :root{
      --bg:#ffffff;          /* white background */
      --ink:#111;            /* text color */
      --muted:#7a7a7a;       /* secondary text */
      --box:#7cc7f3;         /* box sides */
      --lid:#4da6ff;         /* box lid */
      --card:#f7ebe0;        /* card color */
      --accent:#0a66c2;      /* focus/active */
      --shadow: 0 8px 24px rgba(0,0,0,.12);
    }

    html,body{background:var(--bg);color:var(--ink);font:16px/1.4 system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;margin:0;height:100%}

    .app{display:grid;grid-template-columns: minmax(300px, 620px) 1fr; gap:28px; padding:28px; max-width:1200px;margin:auto}

    /* ===== Left: Box + Stage ===== */
    .stage{position:relative;min-height:520px;border-radius:20px; background:repeating-linear-gradient(0deg,#f6f6f6 0 28px,#fff 28px 56px); box-shadow: var(--shadow); overflow:hidden}

    .floor{position:absolute;inset:auto 0 0 0;height:160px;background:radial-gradient(ellipse at center, #e9f4ff 0, #e1f0ff 40%, #ffffff 75%);}

    /* 3D-ish recipe box */
    .box{position:absolute;left:56px;bottom:90px;width:260px;height:160px;transform-style:preserve-3d;}
    .box .body{position:absolute;inset:0;background:var(--box);border-radius:8px;box-shadow:0 12px 24px rgba(0,0,0,.2)}
    .box .side{position:absolute;top:0;right:-20px;width:24px;height:100%;background:#82cff6;transform:skewY(-6deg);border-radius:0 8px 8px 0}
    .box .lip{position:absolute;left:0;right:0;top:-18px;height:26px;background:#a0d6ff;border-radius:10px 10px 0 0}

    /* Lid that opens */
    .lid{position:absolute;left:0;right:-20px;top:-78px;height:70px;background:var(--lid);border-radius:10px 10px 0 0; transform-origin: 10% 100%; transform: rotateX(0deg); box-shadow:0 10px 20px rgba(0,0,0,.18)}
    .box.open .lid{animation:openLid .9s cubic-bezier(.2,.9,.24,1) forwards}
    .box.close .lid{animation:closeLid .7s ease-in forwards}

    @keyframes openLid{to{transform: rotateX(-120deg) translateY(-2px)}}
    @keyframes closeLid{from{transform: rotateX(-120deg)} to{transform: rotateX(0deg)}}

    /* Cards stack */
   /* .cards{position:absolute; left:82px; bottom:160px; width:210px; height:280px; pointer-events:none}*/
   /* keep the stage non-clickable */
   .cards { pointer-events: none; z-index: 10; }

   /* but allow clicks on the card + its children */
   .cards .card,
   .cards .card * { pointer-events: auto; }
    .card{position:absolute; inset:auto 0 0 0; margin:auto; width:210px; height:auto; background:var(--card); border-radius:14px; box-shadow:0 6px 16px rgba(0,0,0,.18); transform-origin:50% 100%; opacity:0}
    .card::after{content:""; position:absolute; left:22px; bottom:-20px; width:0; height:0; border:12px solid transparent; border-top-color:var(--card); filter:drop-shadow(0 2px 2px rgba(0,0,0,.1))}

    /* Animation states */
    .card.enter { animation: popOut 5s forwards; }
    .card.exit  { animation: slideBack .45s ease-in forwards; }

    /* Pause state */
    .card.hold  { animation-play-state: paused !important; }

    /* Keyframes with a built-in visual hold between 60% and 80% */
    @keyframes popOut{
      0%   { transform:translateY(20px) scale(.92) rotate(-2deg); opacity:0; }
      60%  { transform:translateY(-120px) scale(1.02) rotate(1deg); opacity:1; }
      80%  { transform:translateY(-120px) scale(1.02) rotate(1deg); opacity:1; } /* visual hold */
      100% { transform:translateY(-100px) rotate(0); opacity:1; }
    }
    @keyframes slideBack{to{transform:translateY(20px) scale(.92); opacity:0}}

    /* Card content */
    .card h3{margin:12px 14px 6px;font-size:18px}
    .meta{margin:0 14px 8px; font-size:12px; color:var(--muted)}
    .card p{margin:0 14px 14px; font-size:14px}
    .card .actions{display:flex; gap:10px; padding:0 14px 12px}
    .btn{appearance:none; border:1px solid #0002; background:#fff; border-radius:10px; padding:8px 10px; cursor:pointer}
    .btn:focus{outline:2px solid var(--accent)}

    /* Controls */
    .controls{position:absolute; left:56px; bottom:22px; display:flex; align-items:center; gap:12px}
    .toggle{border:none; padding:10px 14px; border-radius:12px; background:var(--accent); color:#fff; cursor:pointer; box-shadow:0 6px 14px rgba(10,102,194,.35)}
    .toggle:focus{outline:3px solid #9ac7ff}

    /* ===== Right: Index ===== */
    .panel{display:flex; flex-direction:column; gap:12px}
    .panel .cardlike{background:#fff; border:1px solid #00000014; border-radius:16px; box-shadow: var(--shadow); padding:16px}

    .searchbar{display:flex; gap:10px}
    .searchbar input{flex:1; padding:10px 12px; border-radius:12px; border:1px solid #0002}
    .searchbar select{padding:10px 12px; border-radius:12px; border:1px solid #0002}

    .index{max-height:420px; overflow:auto; padding-right:8px}
    .index a{display:flex; justify-content:space-between; align-items:center; gap:10px; padding:10px 12px; border-radius:10px; text-decoration:none; color:inherit}
    .index a:hover{background:#f6f9ff}
    .tag{font-size:12px; color:#245; background:#e7f2ff; border:1px solid #cfe6ff; padding:2px 8px; border-radius:999px}

    /* Mobile: index becomes dropdown stacked under stage */
    @media (max-width: 880px){
      .app{grid-template-columns: 1fr}
      .stage{min-height:560px}
      .panel{order:-1}
    }
  </style>
</head>
<body>
  <main class="app" aria-label="Recipe box application">
    <!-- Left: the animated box and card stage -->
    <section class="stage" aria-label="Recipe box">
      <div class="floor"></div>

      <div id="recipeBox" class="box close" aria-live="polite" aria-atomic="true">
        <div class="body" aria-hidden="true"></div>
        <div class="side" aria-hidden="true"></div>
        <div class="lip" aria-hidden="true"></div>
        <div class="lid" role="img" aria-label="Box lid"></div>
      </div>

      <!-- Cards stack (animated) -->
      <div id="cards" class="cards" aria-label="Active recipe card"></div>

      <div class="controls">
        <button id="toggleBox" class="toggle" aria-controls="recipeBox">Open Box</button>
        <button id="shuffle" class="btn" title="Show a random recipe">Random</button>
        <button id="clear" class="btn" title="Put card away">Put Away</button>
        <button id="pause" class="btn" title="Pause/Resume card">Pause/Resume</button>
      </div>
    </section>

    <!-- Right: searchable, scrollable index (with dropdown) -->
    <aside class="panel" aria-label="Recipe index and filters">
      <div class="cardlike">
        <div class="searchbar">
          <input id="q" type="search" placeholder="Search recipes (title or tag)" aria-label="Search recipes" />
          <select id="quickSelect" aria-label="Quick select recipe">
            <option value="">Jump to…</option>
          </select>
        </div>
      </div>
      <div class="cardlike">
        <strong style="display:block; margin-bottom:8px">Index</strong>
        <nav id="index" class="index" aria-label="Recipe list"></nav>
      </div>
    </aside>
  </main>

  <template id="cardTemplate">
    <article class="card" role="article">
      <h3></h3>
      <p class="meta"></p>
      <p class="body"></p>
      <div class="actions">
        <button class="btn view">View</button>
        <button class="btn save">Save</button>
      </div>
    </article>
  </template>

  <script>
    // ===== Configuration =====
    const HOLD_MS = 700; // Visible pause length for .hold interactions

    // ===== Data (example recipes) =====
    const RECIPES = [
      { id:"lemon-bars", title:"Sunny Lemon Bars", time:"40 min", tags:["dessert","bake"], body:"Shortbread crust, lemony custard, powdered sugar finish." },
      { id:"skillet-ziti", title:"Weeknight Skillet Ziti", time:"25 min", tags:["pasta","one-pan"], body:"Brown sausage, add marinara, dry ziti, water; cover and simmer." },
      { id:"crisp-salad", title:"Crunchy Chopped Salad", time:"15 min", tags:["salad","fresh"], body:"Romaine, cucumbers, peppers, chickpeas, feta, lemon-oregano vinaigrette." },
      { id:"sheet-pan-chicken", title:"Sheet-Pan Paprika Chicken", time:"35 min", tags:["chicken","sheet-pan"], body:"Toss thighs with paprika, garlic, potatoes; roast until crispy." },
      { id:"no-knead", title:"No-Knead Pot Bread", time:"4 hr (hands-off)", tags:["bread"], body:"Mix flour, yeast, salt, water; long rest; bake in hot Dutch oven." },
      { id:"overnight-oats", title:"Overnight Oats Starter", time:"5 min + overnight", tags:["breakfast","make-ahead"], body:"Rolled oats, milk, chia, dash of maple; chill and top as desired." },
    ];

    // ===== DOM helpers =====
    const $  = (sel, ctx=document) => ctx.querySelector(sel);
    const $$ = (sel, ctx=document) => Array.from(ctx.querySelectorAll(sel));

    const box        = $('#recipeBox');
    const cards      = $('#cards');
    const index      = $('#index');
    const quickSelect= $('#quickSelect');

    // Populate index and quickSelect
    function renderIndex(list){
      index.innerHTML = '';
      list.forEach(r => {
        const a = document.createElement('a');
        a.href = `#${r.id}`; a.dataset.id = r.id; a.setAttribute('role','button');
        a.innerHTML = `<span>${r.title}</span><span class="tag">${r.tags[0]||''}</span>`;
        a.addEventListener('click', e => { e.preventDefault(); showRecipe(r.id); });
        index.appendChild(a);
      });

      quickSelect.innerHTML = '<option value="">Jump to…</option>' + list.map(r=>`<option value="${r.id}">${r.title}</option>`).join('');
    }

    // Build card element from template
    function buildCard(recipe){
      const tpl = $('#cardTemplate');
      const card = tpl.content.firstElementChild.cloneNode(true);
      card.querySelector('h3').textContent = recipe.title;
      card.querySelector('.meta').textContent = `${recipe.time} • ${recipe.tags.join(', ')}`;
      card.querySelector('.body').textContent = recipe.body;
      card.querySelector('.view').addEventListener('click',()=>alert(`${recipe.title}\n\n${recipe.body}`));
      card.querySelector('.save').addEventListener('click',()=>saveRecipe(recipe));
      return card;
    }

    // Simple save to localStorage
    function saveRecipe(r){
      const saved = JSON.parse(localStorage.getItem('savedRecipes')||'[]');
      if(!saved.find(x=>x.id===r.id)) saved.push(r);
      localStorage.setItem('savedRecipes', JSON.stringify(saved));
      alert('Saved to this browser.');
    }

    // Animate a card popping out of the box, with an optional hold on the previous card
    function showRecipe(id, { holdPrev = true, holdMs = HOLD_MS } = {}) {
      const recipe = RECIPES.find(r => r.id === id) || RECIPES[0];

      box.classList.remove('close');
      box.classList.add('open');
      $('#toggleBox').textContent = 'Close Box';

      // If a card is already out, optionally pause it, then slide it back and remove
      const current = $('.card.enter, .card.exit', cards);
      if (current) {
        const removeAfterExit = () => current.remove();

        if (holdPrev) {
          current.classList.add('hold'); // pause at current frame

          setTimeout(() => {
            current.classList.remove('hold');   // resume
            current.classList.remove('enter');
            current.classList.add('exit');      // triggers slideBack
            current.addEventListener('animationend', removeAfterExit, { once: true });
          }, holdMs);
        } else {
          current.classList.remove('enter');
          current.classList.add('exit');
          current.addEventListener('animationend', removeAfterExit, { once: true });
        }
      }

      // Build and animate the new card out of the box
      const card = buildCard(recipe);
      card.classList.add('enter');  // triggers popOut
      cards.appendChild(card);
    }

    // ===== Controls =====
    // Open/Close box with a real visible hold when closing
    $('#toggleBox').addEventListener('click', () => {
      if (box.classList.contains('open')) {
        box.classList.remove('open');
        box.classList.add('close');
        $('#toggleBox').textContent = 'Open Box';

        // Put card away with a real hold
        const current = $('.card.enter, .card.exit', cards);
        if (current) {
          current.classList.add('hold');

          setTimeout(() => {
            current.classList.remove('hold');
            current.classList.remove('enter');
            current.classList.add('exit');
            current.addEventListener('animationend', () => current.remove(), { once: true });
          }, HOLD_MS);
        }
      } else {
        box.classList.remove('close');
        box.classList.add('open');
        $('#toggleBox').textContent = 'Close Box';
      }
    });

    // Random
    $('#shuffle').addEventListener('click', ()=>{
      const r = RECIPES[Math.floor(Math.random()*RECIPES.length)];
      showRecipe(r.id);
    });

    // Put Away with visible hold
    $('#clear').addEventListener('click', ()=>{
      const current = $('.card.enter, .card.exit', cards);
      if (current) {
        current.classList.add('hold');
		current.classList.remove('enter');

        setTimeout(() => {
          current.classList.remove('hold');
          current.classList.remove('enter');
          current.classList.add('exit');
          current.addEventListener('animationend', () => current.remove(), { once: true });
        }, HOLD_MS);
      }
    });

    // Pause/Resume button for the active card (manual control)
    $('#pause').addEventListener('click', ()=>{
      const current = $('.card.enter, .card.exit', cards);
      if (!current) return;
      current.classList.toggle('hold');
    });
	
	//allow clickable area in cards
	cards.addEventListener('click', (e) => {
	  const btn = e.target.closest('.btn.view');
	  if (!btn) return;

	  const cardEl = btn.closest('.card');
	  const title = cardEl.querySelector('h3')?.textContent || '';
	  const meta  = cardEl.querySelector('.meta')?.textContent || '';
	  const body  = cardEl.querySelector('.body')?.textContent || '';

	  // your modal or alert:
	  alert(`${title}\n${meta}\n\n${body}`);
	});
	

    // Search / filter
    $('#q').addEventListener('input', (e)=>{
      const q = e.target.value.trim().toLowerCase();
      const filtered = RECIPES.filter(r => r.title.toLowerCase().includes(q) || r.tags.some(t=>t.toLowerCase().includes(q)));
      renderIndex(filtered);
    });

    quickSelect.addEventListener('change', (e)=>{ if(e.target.value) showRecipe(e.target.value); });

    // Initial render
    renderIndex(RECIPES);
  </script>
</body>
</html>
